import requests
import json


HH_API = 'https://api.hh.ru/' #"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å HTTP GET-–∑–∞–ø—Ä–æ—Å (–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö) –Ω–∞ –≤–æ—Ç —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å: employer_url"


def get_company_data(employer_id):
    """–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ –ø–æ ID.
    
    Args:
        employer_id (int): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è –Ω–∞ HH.ru
        
    Returns:
        dict: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ
    """

    employer_url = f'{HH_API}employers/{employer_id}'


    #–í—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å URL, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å –±—É–¥–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å.
    #–ü–æ—á–µ–º—É: –≠—Ç–æ **–æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ** –¥–ª—è **–æ—Ç–ª–∞–¥–∫–∏**! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, —Ç—ã —Å—Ä–∞–∑—É —É–≤–∏–¥–∏—à—å, –∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –∑–∞–ø—Ä–æ—Å. üëÄ

    print(f'–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ URL: {employer_url}')

    #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º ** –æ—Å–Ω–æ–≤–Ω–æ–π ** –∑–∞–ø—Ä–æ—Å –∫ API hh.ru, –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É `requests`.
    # –ü–æ—á–µ–º—É: –ú–µ—Ç–æ–¥ `.get()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∞–¥—Ä–µ—Å—É. üåê
    response = requests.get(employer_url) #"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å HTTP GET-–∑–∞–ø—Ä–æ—Å (–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö) –Ω–∞ –≤–æ—Ç —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å: employer_url"
    response.raise_for_status()
    # 4. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–≤–µ—Ç –∏–∑ JSON –≤ —Å–ª–æ–≤–∞—Ä—å Python
    employer_data = response.json()
    print(f'–î–∞–Ω–Ω—ã–µ –ø–æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—é {employer_id} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã')
    
    # –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è
    employer_data['vacancies'] = get_company_vacancies(employer_id)
    
    return employer_data


def get_company_vacancies(employer_id):
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ ID —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è.
    
    Args:
        employer_id (int): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è –Ω–∞ HH.ru
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –≤–∞–∫–∞–Ω—Å–∏—è—Ö
    """
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –≤–∞–∫–∞–Ω—Å–∏–π —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –ø–æ–∏—Å–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—é
    vacancies_url = f'{HH_API}vacancies'
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞: –∏—â–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è
    # per_page=100 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–∫–∞–Ω—Å–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    params = {
        'employer_id': employer_id,
        'per_page': 100
    }
    
    print(f'–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è {employer_id}...')
    
    try:
        response = requests.get(vacancies_url, params=params)
        response.raise_for_status()
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –≤–∞–∫–∞–Ω—Å–∏—è—Ö –∏–∑ –æ—Ç–≤–µ—Ç–∞
        vacancies_data = response.json()
        vacancies_list = vacancies_data.get('items', [])
        
        print(f'–ü–æ–ª—É—á–µ–Ω–æ {len(vacancies_list)} –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è {employer_id}')
        return vacancies_list
        
    except Exception as e:
        print(f'‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∞–∫–∞–Ω—Å–∏–π —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è {employer_id}: {e}')
        return []  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
